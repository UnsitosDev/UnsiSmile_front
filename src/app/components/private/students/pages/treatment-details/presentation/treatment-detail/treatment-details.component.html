@if(!isLoading && !isLoadingGeneralMedicalRecord) {
<!-- card patient -->
<mat-card appearance="outlined" class="custom mb-4">
  <app-card-patient-data [patientUuid]="patientUuid"></app-card-patient-data>
</mat-card>

<div class="flex justify-between w-full mb-4">
  <button
    mat-button
    class="button-custom-back !text-white"
    (click)="backToTreatments()"
  >
    <i class="fas fa-arrow-left mr-2"></i>Regresar
  </button>

  @if (treatmentDetails.status === STATUS.IN_PROGRESS) {
  <button
    mat-button
    class="button-custom-back !text-white"
    (click)="openDialogSendToReview()"
  >
    Enviar tratamiento a revisión<i class="fas fa-file-upload ml-2"></i>
  </button>
  } @else {
  <span
    class="treatment-status-badge"
    [class.in-review-treatment]="treatmentDetails.status === STATUS.IN_REVIEW"
    [class.approved-treatment]="treatmentDetails.status === STATUS.APPROVED"
    [class.rejected-treatment]="treatmentDetails.status === STATUS.REJECTED"
    [class.in-progress-treatment]="
      treatmentDetails.status === STATUS.IN_PROGRESS
    "
    [class.finished-treatment]="treatmentDetails.status === STATUS.FINISHED"
  >
    @switch (treatmentDetails.status) { @case (STATUS.IN_REVIEW) { Tratamiento
    en revisión } @case (STATUS.APPROVED) { Aprobado } @case (STATUS.REJECTED) {
    Rechazado } @case (STATUS.IN_PROGRESS) { En progreso } @case
    (STATUS.FINISHED) { Finalizado } }
  </span>
  }
</div>

<!-- Tab 2: Historia clínica general -->
<mat-tab-group
  class="custom-background"
  mat-stretch-tabs="false"
  mat-align-tabs="start"
  (selectedTabChange)="onTabSelected($event)"
>
  <mat-tab>
    <ng-template mat-tab-label>
      <i class="fas fa-folder"></i>
      <span class="ml-2">Historia clínica general</span>
    </ng-template>
    <app-students-general-history
      [patientUuid]="patientUuid"
    ></app-students-general-history>
  </mat-tab>

  <!-- Tab 3: hitorias clinicas por tratamietos -->
  <mat-tab>
    <ng-template mat-tab-label>
      <i class="fas fa-file"></i>
      <span class="ml-2">{{
        treatmentDetails.treatment.clinicalHistoryCatalogName
      }}</span>
    </ng-template>
    @switch (medicalRecordId) { @case (2) {
    <!--Protesis bucal-->
    <app-oral-prosthesis [patientUuid]="patientUuid"></app-oral-prosthesis>
    } @case (3) {
    <!-- Periodoncia -->
    <app-students-periodontics-history
      [patientUuid]="patientUuid"
    ></app-students-periodontics-history>
    } @case (4) {
    <!-- Operatioria dental -->
    <app-students-dental-operation
      [patientUuid]="patientUuid"
    ></app-students-dental-operation>
    } @case (5) {
    <!-- Cirujia bucal -->
    <app-students-oral-surgery-history
      [patientUuid]="patientUuid"
    ></app-students-oral-surgery-history>
    } @case (6) {
    <app-preventive-dentistry-public-health
      [medicalRecord]="medicalRecordId"
      [patientUuid]="patientUuid"
      [patientMedicalRecord]="patientClinicalHistoryId"
    ></app-preventive-dentistry-public-health>
    } @default {
    <p>No existe esta historia clinica.</p>
    } }
  </mat-tab>

  <!-- Tab 4: Odontograma -->

  <mat-tab>
    <ng-template mat-tab-label>
      <i class="fas fa-file"></i>
      <span class="ml-2">
        Odontograma
      </span>
    </ng-template>
    
    @if(creatingOdontogram){
      <app-students-odontogram
      [patientId]="patientUuid"
      [idTreatmentDetails]="treatmentDetails.idTreatmentDetail"
      [state]="'create'"
      (transactionCarriedOut)="transactionCarriedOut()"
      (cancel)="cancelOdontogramCreation()"
      ></app-students-odontogram>
    }@else {
      <div class="odontogram-tab-content">
        <div class="action-container">
          <button mat-raised-button color="primary" (click)="changeOdontogramViewStatus()">
            <i class="fas fa-tooth mr-2"></i>
            Crear Nuevo Odontograma
          </button>
        </div>

        <mat-card appearance="outlined" class="custom mb-4">
          <mat-card-header class="w-full">
            <mat-card-title>Historial de Odontogramas</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-odontogram-list 
            [treatmentId]="treatmentDetails.idTreatmentDetail"
            [patientUuid]="patientUuid"
            >
            </app-odontogram-list>
          </mat-card-content>
        </mat-card>
      </div>
    }
    
  </mat-tab>
</mat-tab-group>
}

<app-loading />

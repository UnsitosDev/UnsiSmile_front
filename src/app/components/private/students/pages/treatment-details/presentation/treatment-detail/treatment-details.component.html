@if(!isLoading && !isLoadingGeneralMedicalRecord) {
<!-- card patient -->
<mat-card appearance="outlined" class="custom mb-4">
  <app-card-patient-data
    [patientUuid]="patientUuid"
    [treatmentData]="treatmentDetails"
  ></app-card-patient-data>
</mat-card>

<div class="flex justify-between w-full mb-4">
  <button
    mat-button
    class="button-custom-back !text-white"
    (click)="backToTreatments()"
  >
    <i class="fas fa-arrow-left mr-2"></i>Regresar
  </button>

  @if (treatmentDetails.status === STATUS.IN_PROGRESS) {
  <button
    mat-button
    class="button-custom-back !text-white"
    (click)="openDialogSendToReview()"
  >
    Enviar tratamiento a revisión<i class="fas fa-file-upload ml-2"></i>
  </button>
  } @else {
  <div
    class="flex-shrink-0 flex flex-wrap gap-2 sm:gap-2 sm:items-center ml-4 md:px-4 lg:px-6"
  >
    @switch (treatmentDetails.status) { @case (STATUS.IN_REVIEW) {
    <button mat-stroked-button class="whitespace-nowrap" disabled>
      <span class="flex items-center in-review"
        ><i class="far fa-clock mr-1"></i>En revisión</span
      >
    </button>
    } @case (STATUS.APPROVED) {
    <button mat-stroked-button class="whitespace-nowrap" disabled>
      <span class="flex items-center approved"
        ><i class="fas fa-check-circle mr-1"></i>Aprobado</span
      >
    </button>
    } @case (STATUS.REJECTED) {
    <button mat-stroked-button class="whitespace-nowrap" (click)="openDialogDetailsTreatment(treatmentDetails)">
      <span class="flex items-center"><i class="fas fa-info-circle mr-1"></i>Detalles del tratamiento</span>
    </button>
    <button mat-stroked-button class="whitespace-nowrap" disabled>
      <span class="flex items-center rejected"
        ><i class="fas fa-times-circle mr-1"></i>Rechazado</span
      >
    </button>
    } @case (STATUS.IN_PROGRESS) {
    <button mat-stroked-button class="whitespace-nowrap" disabled>
      <span class="flex items-center in-progress"
        ><i class="fas fa-solid fa-spinner mr-1"></i>En progreso</span
      >
    </button>
    } @case (STATUS.FINISHED) {
    <button mat-stroked-button class="whitespace-nowrap" disabled>
      <span class="flex items-center finished"
        ><i class="fas fa-user-check mr-1"></i>Finalizado</span
      >
    </button>
    } @case (STATUS.CANCELLED) {
    <button mat-stroked-button class="whitespace-nowrap" disabled>
      <span class="rejected flex items-center">
        <i class="fas fa-times-circle mr-1"></i>Cancelado
      </span>
    </button>
    } @case (STATUS.NOT_APPROVED) {
    <button mat-stroked-button class="whitespace-nowrap">
      <span class="flex items-center"><i class="fas fa-comment-alt"></i></span>
    </button>

    <button mat-stroked-button class="whitespace-nowrap">
      <span class="flex items-center rejected"
        ><i class="fas fa-times-circle mr-1"></i>No aprobado</span
      >
    </button>

    <button
      mat-stroked-button
      class="whitespace-nowrap"
      matTooltip="Actualizar fecha de tratamiento"
    >
      <span class="flex items-center"
        ><i class="fas fa-edit mr-1"></i>Actualizar</span
      >
    </button>
    } @case (STATUS.AWAITING_APPROVAL) {
    <button mat-stroked-button class="whitespace-nowrap" disabled>
      <span class="in-progress flex items-center">
        <i class="fas fa-solid fa-spinner mr-1"></i>En espera de aprobación
      </span>
    </button>
    } }
  </div>
  }
</div>

<!-- Tab 2: Historia clínica general -->
<mat-tab-group
  class="custom-background"
  mat-stretch-tabs="false"
  mat-align-tabs="start"
  (selectedTabChange)="onTabSelected($event)"
>
  <mat-tab>
    <ng-template mat-tab-label>
      <i class="fas fa-folder"></i>
      <span class="ml-2">Historia clínica general</span>
    </ng-template>
    <app-students-general-history
      [patientUuid]="patientUuid"
    ></app-students-general-history>
  </mat-tab>

  <!-- Tab 3: hitorias clinicas por tratamietos -->
  <mat-tab>
    <ng-template mat-tab-label>
      <i class="fas fa-file"></i>
      <span class="ml-2">{{
        treatmentDetails.treatment.clinicalHistoryCatalogName
      }}</span>
    </ng-template>
    @switch (medicalRecordId) { @case (2) {
    <!--Protesis bucal-->
    <app-oral-prosthesis
      [readonlyTreatment]="readonlyTreatment"
      [patientUuid]="patientUuid"
    ></app-oral-prosthesis>
    } @case (3) {
    <!-- Periodoncia -->
    <app-students-periodontics-history
      [readonlyTreatment]="readonlyTreatment"
      [patientUuid]="patientUuid"
    ></app-students-periodontics-history>
    } @case (4) {
    <!-- Operatioria dental -->
    <app-students-dental-operation
      [readonlyTreatment]="readonlyTreatment"
      [patientUuid]="patientUuid"
    ></app-students-dental-operation>
    } @case (5) {
    <!-- Cirujia bucal -->
    <app-students-oral-surgery-history
      [readonlyTreatment]="readonlyTreatment"
      [patientUuid]="patientUuid"
    ></app-students-oral-surgery-history>
    } @case (6) {
    <app-preventive-dentistry-public-health
      [readonlyTreatment]="readonlyTreatment"
      [patientUuid]="patientUuid"
    ></app-preventive-dentistry-public-health>
    } @default {
    <p>No existe esta historia clinica.</p>
    } }
  </mat-tab>

  <!-- Tab 4: Odontograma -->

  <mat-tab>
    <ng-template mat-tab-label>
      <i class="fas fa-tooth"></i>
      <span class="ml-2"> Odontograma </span>
    </ng-template>

    @if(creatingOdontogram){
    <app-students-odontogram
      [patientId]="patientUuid"
      [idTreatmentDetails]="treatmentDetails.idTreatmentDetail"
      [state]="'create'"
      (transactionCarriedOut)="transactionCarriedOut()"
      (cancel)="cancelOdontogramCreation()"
    ></app-students-odontogram>
    }@else {
    <div class="odontogram-tab-content">
      <div class="action-container">
        <button
          mat-raised-button
          color="primary"
          (click)="changeOdontogramViewStatus()"
        >
          <i class="fas fa-plus mr-2"></i>
          Nuevo odontograma
        </button>
      </div>
      <mat-card-title
        ><strong>Historial de odontogramas</strong></mat-card-title
      >
      <mat-card appearance="outlined" class="custom">
        <mat-card-content>
          <app-odontogram-list
            [treatmentId]="treatmentDetails.idTreatmentDetail"
            [patientUuid]="patientUuid"
          >
          </app-odontogram-list>
        </mat-card-content>
      </mat-card>
    </div>
    }
  </mat-tab>
</mat-tab-group>
}

<app-loading />

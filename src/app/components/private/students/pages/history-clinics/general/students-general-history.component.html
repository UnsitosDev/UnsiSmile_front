

    <mat-card appearance="outlined" class="custom">
        <app-card-patient-data [data]="patientData" [guardianData]="guardianData"></app-card-patient-data>
      </mat-card>
      <br>
      @if (mappedHistoryData) {
        <mat-card-title>
            <div class="title-container">
              <span><strong>Historia clínica {{mappedHistoryData.title}}</strong></span>
              <span>
                <strong>Número de expediente: {{mappedHistoryData.medicalRecordNumber}}</strong> - 
                @if (!status) {
                    <button class="button-custom" (click)="openConfirmDialog()">Enviar a revision <i class="fas fa-file-upload"></i></button>
                }
                @if (status) {
                    <span class="status" [innerHTML]="translateStatus(status.status)"></span>
                }
              </span> 
            </div>
        </mat-card-title>
        <mat-card class="custom">
              <mat-tab-group [(selectedIndex)]="currentIndex">
                  @for (tab of mappedHistoryData.tabs; track tab) {
                      <mat-tab [label]="tab.title">
                          @if (tab.title === 'Odontograma inicial' && !tab.isAnswered) {
                              <app-students-odontogram
                              [state]="'create'" 
                              [patientId]="idpatient" 
                              [idQuestion]="tab.seccion?.[0]?.questionID ?? 0"
                              [idClinicalHistoryPatient]=idPatientClinicalHistory
                              [idFormSection]=6
                              [idClinicalHistoryPatient]=idPatientClinicalHistory
                              (nextMatTab)="onNextTab()"
                              (previousMatTab)="onPreviousTab()"
                              >
                              </app-students-odontogram>
                          }
                          @if (tab.title === 'Odontograma final' && !tab.isAnswered) {
                              <app-students-odontogram
                              [state]="'read-latest'" 
                              [patientId]="idpatient"
                              [idClinicalHistoryPatient]=idPatientClinicalHistory
                              [idQuestion]="tab.seccion?.[0]?.questionID ?? 0"
                              [idFormSection]=7
                              (nextMatTab)="onNextTab()"
                              (previousMatTab)="onPreviousTab()"
                              >
                              </app-students-odontogram>
                          }
                          @if (tab.title === 'Odontograma final' && tab.isAnswered) {
                            <app-students-odontogram
                            [state]="'read'" 
                            [patientId]="idpatient"
                            [idClinicalHistoryPatient]=idPatientClinicalHistory
                            [idQuestion]="tab.seccion?.[0]?.questionID ?? 0"
                            [idFormSection]=7
                            (nextMatTab)="onNextTab()"
                            (previousMatTab)="onPreviousTab()"
                            >
                            </app-students-odontogram>
                        }
                          @if (tab.title === 'Medición de bolsas inicial' && !tab.isAnswered) {
                              <app-history-initial-bag
                              [idClinicalHistoryPatient]=idPatientClinicalHistory
                              [state]="'create'"
                              [idQuestion]="tab.seccion?.[0]?.questionID ?? 0"
                              [patientId]="idpatient"
                              (nextMatTab)="onNextTab()"
                              (previousMatTab)="onPreviousTab()"
                              ></app-history-initial-bag>
                          }
                          @if (tab.title === 'Medición de bolsas inicial' && tab.isAnswered) {
                            <app-history-initial-bag
                            [idClinicalHistoryPatient]=idPatientClinicalHistory
                              [state]="'read'"
                              [idQuestion]="tab.seccion?.[0]?.questionID ?? 0"
                              [patientId]="idpatient"
                              (nextMatTab)="onNextTab()"
                              (previousMatTab)="onPreviousTab()"
                              ></app-history-initial-bag>
                          }
                          @if (tab.isAnswered && tab.title !== 'Odontograma inicial' && tab.title !== 'Odontograma final' && tab.title !== 'Medición de bolsas inicial') {
                              <app-tab-form-update
                              [fieldsTab]="tab" 
                              (nextMatTab)="onNextTab()"
                              (previousMatTab)="onPreviousTab()"
                              ></app-tab-form-update>
                          }
                          @if (!tab.isAnswered && tab.title !== 'Odontograma inicial' && tab.title !== 'Odontograma final' && tab.title !== 'Medición de bolsas inicial') {
                              <app-tab-form 
                              [fieldsTab]="tab" 
                              (nextMatTab)="onNextTab()"
                              (previousMatTab)="onPreviousTab()"                      
                          ></app-tab-form>
                          }

                          <!-- components to render if the question is anwered -->
                          @if (tab.title === 'Odontograma inicial' && tab.isAnswered) {
                            <app-students-odontogram
                              [state]="'read'" 
                              [patientId]="idpatient" 
                              [idQuestion]="tab.seccion?.[0]?.questionID ?? 0"
                              [idClinicalHistoryPatient]=idPatientClinicalHistory
                              [idFormSection]=6
                              [idClinicalHistoryPatient]=idPatientClinicalHistory
                              (nextMatTab)="onNextTab()"
                              (previousMatTab)="onPreviousTab()"
                              >
                              </app-students-odontogram>
                        }
                      </mat-tab>
                  }
              </mat-tab-group>
          </mat-card>
      }

<mat-card-title>
  <div class="title-container">
    <span><strong>{{ isEditMode ? 'Editar' : 'Crear' }} tratamiento</strong></span>
    <span (click)="closeDialog()" class="close-btn cursor-pointer">
      <i class="fas fa-times"></i>
    </span>
  </div>
</mat-card-title>

<div class="p-4 custom-dialog">
  <!-- Selección de tratamiento -->
  <mat-form-field class="p-2 w-full">
    <mat-label>Tratamiento</mat-label>
    <mat-select [formControl]="treatmentControl" 
                (selectionChange)="onTreatmentSelected($event)"
                [disabled]="isEditMode">
      @for (item of treatmentData; track item.idTreatment) {
      <mat-option [value]="item">{{item.name}}</mat-option>
      }
    </mat-select>
    @if (treatmentControl.invalid && treatmentControl.touched) {
      <mat-error>Seleccione un tratamiento</mat-error>
    }
  </mat-form-field>

  <!-- Fechas -->
  <div class="flex justify-center">
    <!-- Fecha de inicio -->
    <mat-form-field class="mx-2 w-full">
      <mat-label>Fecha inicio</mat-label>
      <input matInput [matDatepicker]="startPicker" [formControl]="startDateControl">
      <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
      <mat-datepicker #startPicker></mat-datepicker>
      @if (startDateControl.invalid && startDateControl.touched) {
        <mat-error>Ingrese una fecha válida</mat-error>
      }
    </mat-form-field>

    <!-- Fecha final -->
    <mat-form-field class="mx-2 w-full">
      <mat-label>Fecha final</mat-label>
      <input matInput [matDatepicker]="endPicker" [formControl]="endDateControl">
      <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
      <mat-datepicker #endPicker></mat-datepicker>
      @if (endDateControl.invalid && endDateControl.touched) {
        <mat-error>Ingrese una fecha válida</mat-error>
      }
    </mat-form-field>
  </div>

  <!-- Selector de dientes (condicional) -->
  @if (selectedTreatmentsName == 'Diente') {
    <mat-form-field class="p-2 w-full" [class.mat-form-field-invalid]="itemTeeth.invalid && itemTeeth.touched">
      <mat-label>Órganos dentarios</mat-label>
      <mat-select [formControl]="itemTeeth" multiple class="teeth-multiselect">
        @for (item of teeth; track item.idTooth) {
        <mat-option [value]="item">{{item.idTooth}}</mat-option>
        }
      </mat-select>
      @if (itemTeeth.invalid && itemTeeth.touched) {
        <mat-error>Seleccione al menos un diente</mat-error>
      }
    </mat-form-field>
  }

  <!-- Botón de acción -->
  <div class="mx-2 flex justify-end">
    <button mat-button (click)="saveTreatment()">{{ isEditMode ? 'Actualizar' : 'Crear' }} tratamiento</button>
  </div>
</div>
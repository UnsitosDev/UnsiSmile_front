<mat-card class="full-width-card">
  <mat-card-title><strong>Revisi칩n de tratamientos</strong></mat-card-title>
</mat-card>

<mat-form-field class="mt-4 w-full">
  <mat-label>Seleccione tratamientos: Por revisar, aprobados o rechazados</mat-label>
  <mat-select [formControl]="statusControl" (selectionChange)="fetchTreatments()">
    <mat-option [value]="STATUS.IN_REVIEW">Tratamientos por revisar</mat-option>
    <mat-option [value]="STATUS.APPROVED">Tratamientos aprobados</mat-option>
    <mat-option [value]="STATUS.REJECTED">Tratamientos rechazadas</mat-option>
  </mat-select>
</mat-form-field>

@if (!treatments || treatments.content.length === 0) {
  <div class="flex justify-center p-6">
    @switch (statusControl.value) {
      @case (STATUS.IN_REVIEW) {
        <span>No hay tratamientos por revisar</span>
      }
      @case (STATUS.APPROVED) {
        <span>No hay tratamientos aprobados</span>
      }
      @case (STATUS.REJECTED) {
        <span>No hay tratamientos rechazados</span>
      }
    }
  </div>
}

<div class="p-4">
  <mat-list>
    @for (treatment of treatments?.content; track $index) {
      <section class="w-full">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between w-full mb-1 gap-2 sm:gap-0">
          <div class="flex-1 min-w-0 sm:pr-4">
            <mat-list-item>
              <span matListItemTitle><strong>Paciente:</strong> {{ treatment.patient.name }}</span>
              <span matListItemTitle><strong>Alumno:</strong> {{ treatment.student.name }}</span>
              <span><strong>Tratamiento:</strong> {{ treatment.treatment.name }}</span>
            </mat-list-item>
          </div>

          <div class="flex-shrink-0 flex flex-wrap gap-2 sm:gap-2 sm:items-center ml-4">
            @switch (treatment.status) {
              @case (STATUS.IN_REVIEW) {
                <button mat-stroked-button class="whitespace-nowrap" disabled>
                  <span class="in-review flex items-center">
                    <i class="far fa-clock mr-1"></i>En revisi칩n
                  </span>
                </button>
              }
              @case (STATUS.APPROVED) {
                <button mat-stroked-button class="whitespace-nowrap" disabled>
                  <span class="approved flex items-center">
                    <i class="fas fa-check-circle mr-1"></i>Aprobado
                  </span>
                </button>
              }
              @case (STATUS.REJECTED) {
                <button mat-stroked-button class="whitespace-nowrap" disabled>
                  <span class="rejected flex items-center">
                    <i class="fas fa-times-circle mr-1"></i>Rechazado
                  </span>
                </button>
              }
              @case (STATUS.IN_PROGRESS) {
                <button mat-stroked-button class="whitespace-nowrap" disabled>
                  <span class="in-progress flex items-center">
                    <i class="fas fa-solid fa-spinner mr-1"></i>En progreso
                  </span>
                </button>
              }
              @case (STATUS.FINISHED) {
                <button mat-stroked-button class="whitespace-nowrap" disabled>
                  <span class="finished flex items-center">
                    <i class="fas fa-user-check mr-1"></i>Finalizado
                  </span>
                </button>
              }
            }

            <!-- Bot칩n Ver tratamiento -->
            <button mat-stroked-button matTooltip="Ver tratamiento" class="whitespace-nowrap">
              <span class="flex items-center" (click)="rateTreatment(treatment)">
                <i class="fas fa-eye cursor-pointer mr-1"></i>
                Calificar tratamiento
              </span>
            </button>
          </div>
        </div>
        <mat-divider></mat-divider>
      </section>
    }
  </mat-list>
</div>

@if (!isLastPage) {
  <div class="text-center mt-3">
    <button mat-stroked-button
            (click)="loadMoreTreatments()"
            [disabled]="isLoading">
      @if (!isLoading) {
        <span> <i class="fas fa-chevron-down"></i> Cargar m치s tratamientos</span>

      }
    </button>
  </div>
}

<app-loading/>


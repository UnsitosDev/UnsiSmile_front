@if(user){
  <mat-card class="full-width-card">
    <mat-card-title><strong>Perfil de Usuario</strong></mat-card-title>
  </mat-card>
  <div class="profile-container">
    <!-- Sidebar con foto y nombre -->
    <div class="profile-sidebar">
      <div class="profile-photo">
        <img [src]="foto() || '../../../assets/images/default-profile-pic.png'"
          alt="Foto de perfil">
      </div>
      <h2 class="profile-name">{{user.person.firstName}} {{user.person.firstLastName}}</h2>
      <p class="profile-role">Usuario</p>
      <label class="btn btn-primary" [class.disabled]="!modoEdicion()">
        Cambiar foto
        <input type="file" 
               (change)="subirFoto($event)" 
               accept="image/jpeg,image/png,image/gif" 
               style="display: none;" 
               [disabled]="!modoEdicion()"
               max-size="5000000">
      </label>
    </div>    
  
    <!-- Contenido principal -->
    <div class="profile-main">
      <!-- Título y pestañas al estilo del header-history-clinic -->
      <div class="title-container">
        <span><strong>{{ getTabTitle() }}</strong></span>
        <div class="tabs-container">
          <button class="tab-arrow left" (click)="scrollTabs('left')" type="button" [disabled]="!canScrollLeft()">&lt;</button>
          <div class="tabs-wrapper" #tabsWrapper>
            @for (tab of tabs; track tab; let i = $index) {
              <button class="tab-button" [class.active]="i === activeTab()" (click)="setActiveTab(i)" #tabButton>
                {{ tab }}
              </button>
            }
          </div>
          <button class="tab-arrow right" (click)="scrollTabs('right')" type="button" [disabled]="!canScrollRight()">&gt;</button>
        </div>
      </div>
  
      <div class="tab-content">
        @switch (activeTab()) {
          
          @case (0) {
            <!-- Overview -->
            <div class="overview-section">
              <div class="welcome-message">
                <h2>{{ welcomeMessage() }}</h2>
                <p>Gestiona tu información personal y configuración desde este panel.</p>
              </div>
              <div class="overview-grid">
                <div class="overview-card">
                  <div class="overview-icon">
                    <i class="fas fa-user"></i>
                  </div>
                  <div class="overview-info">
                    <h3>Información Personal</h3>
                    <p><strong>Nombre:</strong> {{user.person.firstName}} {{user.person.firstLastName}}</p>
                    <p><strong>Email:</strong> {{user.person.email}}</p>
                    <p><strong>Teléfono:</strong> {{user.person.phone}}</p>
                    <p><strong>Género:</strong> {{user.person.gender.gender}}</p>
                    <p><strong>Curp:</strong> {{user.person.curp}}</p>
                    <p><strong>{{ isStudent() ? 'Matrícula:' : 'Número de Empleado:' }}</strong> {{ employeeNumber() }}</p>
                  </div>
                </div>
              </div>
            </div>
          }
          @case (1) {
            <!-- Datos personales -->
            <form (ngSubmit)="actualizarDatosUsuario()" class="form">
              <div class="form-header">
                <h3>Datos Personales</h3>
                <button type="button" class="btn" [class.btn-primary]="!modoEdicion()" [class.btn-warning]="modoEdicion()" (click)="toggleEdicion()">
                  <i class="fas" [class.fa-edit]="!modoEdicion()" [class.fa-times]="modoEdicion()"></i>
                  {{ modoEdicion() ? 'Cancelar Edición' : 'Editar Datos' }}
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label for="nombre">Nombre</label>
                  <input id="nombre" type="text" name="nombre" 
                    [(ngModel)]="user.person.firstName" 
                    class="form-control" 
                    [readonly]="!modoEdicion()"
                    [class.readonly]="!modoEdicion()">
                </div>
                <div class="form-group">
                  <label for="secondName">Segundo Nombre</label>
                  <input id="secondName" type="text" name="secondName" 
                    [(ngModel)]="user.person.secondName" 
                    class="form-control" 
                    [readonly]="!modoEdicion()"
                    [class.readonly]="!modoEdicion()">
                </div>
                <div class="form-group">
                  <label for="apellido">Primer Apellido</label>
                  <input id="apellido" type="text" name="apellido" 
                    [(ngModel)]="user.person.firstLastName" 
                    class="form-control"
                    [readonly]="!modoEdicion()"
                    [class.readonly]="!modoEdicion()">
                </div>
                <div class="form-group">
                  <label for="apellido">Segundo Apellido</label>
                  <input id="apellido" type="text" name="apellido" 
                    [(ngModel)]="user.person.secondLastName" 
                    class="form-control"
                    [readonly]="!modoEdicion()"
                    [class.readonly]="!modoEdicion()">
                </div>
                <div class="form-group">
                  <label for="email">Email</label>
                  <input id="email" type="email" name="email" 
                    [(ngModel)]="user.person.email" 
                    class="form-control"
                    [readonly]="!modoEdicion()"
                    [class.readonly]="!modoEdicion()">
                </div>
                <div class="form-group">
                  <label for="telefono">Teléfono</label>
                  <input id="telefono" type="tel" name="telefono" 
                    [(ngModel)]="user.person.phone" 
                    class="form-control"
                    [readonly]="!modoEdicion()"
                    [class.readonly]="!modoEdicion()">
                </div>
                <div class="form-group active">
                  <label for="gender">Género</label>
                  <select id="gender" name="gender" 
                    [(ngModel)]="selectedGender" 
                    class="form-control"
                    [disabled]="!modoEdicion()"
                    [class.readonly]="!modoEdicion()">
                    @for(gender of genders; track gender.idGender) {
                      <option [value]="gender.idGender">{{gender.gender}}</option>
                    }
                  </select>
                </div>
              </div>
              <button type="submit" class="btn btn-primary" [hidden]="!modoEdicion()">Guardar cambios</button>
            </form>
          }
          
          @case (2) {
            <!-- Cambiar contraseña -->
            <form (ngSubmit)="actualizarContrasena()" class="form">
              <div class="form-group">
                <label for="contrasenaActual">Contraseña Actual</label>
                <div class="password-field">
                  <input id="contrasenaActual" [type]="mostrarContrasenaActual() ? 'text' : 'password'" 
                    name="contrasenaActual" [(ngModel)]="contrasenaActual" class="form-control">
                  <button type="button" class="toggle-password" (click)="mostrarContrasenaActual.set(!mostrarContrasenaActual())">
                    <i class="fas" [class.fa-eye]="!mostrarContrasenaActual()" [class.fa-eye-slash]="mostrarContrasenaActual()"></i>
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label for="nuevaContrasena">Nueva Contraseña</label>
                <div class="password-field">
                  <input id="nuevaContrasena" [type]="mostrarNuevaContrasena() ? 'text' : 'password'" 
                    name="nuevaContrasena" [(ngModel)]="nuevaContrasena" class="form-control">
                  <button type="button" class="toggle-password" (click)="mostrarNuevaContrasena.set(!mostrarNuevaContrasena())">
                    <i class="fas" [class.fa-eye]="!mostrarNuevaContrasena()" [class.fa-eye-slash]="mostrarNuevaContrasena()"></i>
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label for="confirmarContrasena">Confirmar Contraseña</label>
                <div class="password-field">
                  <input id="confirmarContrasena" [type]="mostrarConfirmarContrasena() ? 'text' : 'password'" 
                    name="confirmarContrasena" [(ngModel)]="confirmarContrasena" class="form-control">
                  <button type="button" class="toggle-password" (click)="mostrarConfirmarContrasena.set(!mostrarConfirmarContrasena())">
                    <i class="fas" [class.fa-eye]="!mostrarConfirmarContrasena()" [class.fa-eye-slash]="mostrarConfirmarContrasena()"></i>
                  </button>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Actualizar Contraseña</button>
            </form>
          }
        }
      </div>
    </div>
  </div>
  
}
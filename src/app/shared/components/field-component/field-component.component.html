<div [formGroup]="formGroup">
  @switch (field.type) {    
    @case('multivalued') {
      <div class="grid grid-cols-12 gap-4 items-center">
        <div class="col-span-6 p-4">
          <label>{{ field.label }}</label>
        </div>
        <div class="col-span-2 p-4">
          <section class="example-section">
            <mat-checkbox 
              class="example-margin" 
              [formControlName]="field.name" 
              (change)="onFieldChange('checkbox', field.name, $event)" 
              [checked]="field.answerField?.answerBoolean">
            </mat-checkbox>
          </section>
        </div>
        <div class="col-span-4 p-4">
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Ampliar Respuesta</mat-label>
            <input 
              matInput 
              [required]="isTextRequired"
              [disabled]="disabledMultivalued"
              [placeholder]="field.placeholder"
              [value]="(field.answerField?.answerText == null || field.answerField?.answerText === '' ) ? '' : field.answerField?.answerText"
              (input)="onFieldChange('text', field.name, $event)" />
          </mat-form-field>
        </div>
      </div>
    }
    @case ('boolean') {
      <div class="grid grid-cols-12 gap-4 items-center">
        <div class="col-span-9 p-4">
          <label>{{ field.label }}</label>
        </div>
        <div class="col-span-3 p-4">
          <section class="example-section">
            <mat-checkbox class="example-margin" [formControlName]="field.name" (change)="onValueChangeCheck($event)" [checked]="field.answerField?.answerBoolean"></mat-checkbox>
          </section>
        </div>
      </div>
      <hr> 
    }
    @case ('input') {
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ field.label }}</mat-label>
        <input matInput [placeholder]="field.placeholder" [formControlName]="field.name" (input)="onValueChange($event)"/>
        @if (formGroup.get(field.name)?.hasError('lastError') && formGroup.get(field.name)?.touched && !formGroup.get(field.name)?.hasError('required')) {
          <mat-error>{{ errors?.lastError }}</mat-error>
        }
        @if (formGroup.get(field.name)?.hasError('required')) {
          <mat-error class="error-message">{{ errors?.required }}</mat-error>
        }
      </mat-form-field>
    }   
    @case ('inputText') {
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ field.label }}</mat-label>
        <input matInput type="text" [required]="!!field.required" [pattern]="field.validationFnt?.regex || ''"  [maxlength]="field.max ?? null" [placeholder]="field.placeholder" [value]="field.answerField?.answerText" [formControlName]="field.name" (input)="onValueChange($event)"/>
          @if (formGroup.get(field.name)?.hasError('required')) {
            <mat-error class="error-message">
              El campo {{ field.label }} es requerido
            </mat-error>
          }
          @if (formGroup.get(field.name)?.hasError('pattern')) {
            <mat-error class="error-message">
              {{ field.validationFnt?.message }}
            </mat-error>
          } 
      </mat-form-field>
    }    
    @case ('inputNumber') {
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ field.label }}</mat-label>
        <input matInput type="number" [required]="!!field.required" [pattern]="field.validationFnt?.regex || ''"  [placeholder]="field.placeholder" [value]="field.answerField?.answerNumeric" [formControlName]="field.name" (input)="onValueChange($event)"/>   
        @if (formGroup.get(field.name)?.hasError('lastError') && formGroup.get(field.name)?.touched && !formGroup.get(field.name)?.hasError('required')) {
          <mat-error class="error-message">{{ errors?.lastError }}</mat-error>
        }
        @if (formGroup.get(field.name)?.hasError('required')) {
          <mat-error class="error-message">
            El campo {{ field.label }} es requerido
          </mat-error>
        }
        @if (formGroup.get(field.name)?.hasError('pattern')) {
          <mat-error class="error-message">
            {{ field.validationFnt?.message }}
          </mat-error>
        }
      </mat-form-field>
    }
    @case ('select') {
      <mat-form-field  appearance="fill" class="w-full">
        <mat-label>{{ field.label }}</mat-label>
          <mat-select disableRipple [formControlName]="field.name" (click)="field.onClick && field.onClick($event)" (selectionChange)="onValueChange($event)">  
            @for (option of field.options; track option.value) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
          @if (formGroup.get(field.name)?.hasError('required')) {
            <mat-error class="error-message">El campo {{ field.label }} es requerido</mat-error>
          }
      </mat-form-field>
    }
    @case('datepicker') {
        <mat-form-field appearance="fill" class="w-full"> 
          <mat-label>{{ field.label }}</mat-label>
          <input matInput 
                 [matDatepicker]="datepicker"
                 [formControlName]="field.name" 
                 [max]="maxDate"
                 (dateChange)="onValueChangeDate($event)"
                 (dateInput)="onValueChangeDate($event)"> 
          <mat-datepicker-toggle matSuffix [for]="datepicker"></mat-datepicker-toggle>
          <mat-datepicker #datepicker></mat-datepicker>   
          @if (formGroup.get(field.name)?.errors?.['futureDate'] && formGroup.get(field.name)?.touched) {
            <mat-error>{{ errors?.futureDate }}</mat-error>
          }
          @if (formGroup.get(field.name)?.hasError('underage') && formGroup.get(field.name)?.touched) {
            <mat-error>{{ errors?.underage }}</mat-error>
          }
        </mat-form-field>           
    }
    @case ('inputEvent') {
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ field.label }}</mat-label>
          <input matInput [value]="fieldValue" [formControlName]="field.name" (input)="onInputChange($event)" />
            @if (hasLastError(field.name) && formGroup.get(field.name)?.touched && !formGroup.get(field.name)?.hasError('required')) {
              <mat-error class="error-message">{{ errors?.lastError }}</mat-error>
            }
            @if (formGroup.get(field.name)?.hasError('required')) {
              <mat-error class="error-message">{{ errors?.required }}</mat-error>
            }
      </mat-form-field>
    }
    @case ('autocomplete') {
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>{{field.label}}</mat-label>
          <input type="text" matInput [formControlName]="field.name" [matAutocomplete]="auto" (input)="onInputAutocomplete($event)">
          <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
            @for (option of field.options; track option.value) {
              <mat-option [value]="option.label">{{ option.label }}</mat-option>
            }
          </mat-autocomplete>
        </mat-form-field>      
    }
    @case ('autocompleteoptions') {
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{field.label}}</mat-label>
        <input type="text" matInput [formControlName]="field.name" [matAutocomplete]="auto" (input)="onInputAutocomplete($event)">
        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete" [displayWith]="getOptionLabel(field)">
          @for (option of field.options; track option.value) {
            <mat-option [value]="option.value">{{ option.label }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>      
    }
    @case ('inputFile') {
      <div class="custom-text">
        <mat-label>{{field.label}}</mat-label>
        <input [formControlName]="field.name" type="file" multiple accept="image/*" class="w-full text-gray-600 text-sm border-b border-black focus:border-blue-500 py-2 custom"
               (change)="onValueChangeFile($event)" />
        <p class="text-xs text-gray-500 mt-1">{{field.label}} en formato: jpeg, jpg</p>
        <br>
      </div>
      @if (field.answerField?.files && field.answerField?.files.length > 0) {
        <mat-label>Archivos: </mat-label>
          <mat-list>
            @for (file of field.answerField?.files; track file) {
              <mat-list-item>
                <mat-icon matListItemIcon><i class="fas fa-file-alt"></i></mat-icon>
                <div (click)="onFileClick(file)" matListItemTitle>{{ file.fileName }}</div>
              </mat-list-item>
            }
        </mat-list>
      }
    }
    @case ('textArea') {
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ field.label }}</mat-label>
        <textarea matInput [required]="!!field.required" [placeholder]="field.placeholder" [value]="field.answerField?.answerText" [formControlName]="field.name" (input)="onValueChange($event)"></textarea>
    
        @if (formGroup.get(field.name)?.hasError('required')) {
          <mat-error class="error-message">
            El campo {{ field.label }} es requerido
          </mat-error>
        }
        @if (formGroup.get(field.name)?.hasError('pattern')) {
          <mat-error class="error-message">
            {{ field.validationFnt?.message }}
          </mat-error>
        }

      </mat-form-field>
    }
    @default {
      <p>Tipo de campo no soportado.</p>
    }
  }
</div>